<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>driver/battery/max17055.c - chromiumos/platform/ec - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.css"><link rel="stylesheet" type="text/css" href="/+static/prettify/prettify.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?faa=1&amp;service=gerritcodereview&amp;continue=https://chromium.googlesource.com/login/chromiumos/platform/ec/%2B/08f5a1e6fc2c9467230444ac9b582dcf4d9f0068/driver/battery/max17055.c">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">chromium</a> / <a class="Breadcrumbs-crumb" href="/chromiumos/">chromiumos</a> / <a class="Breadcrumbs-crumb" href="/chromiumos/platform/">platform</a> / <a class="Breadcrumbs-crumb" href="/chromiumos/platform/ec/">ec</a> / <a class="Breadcrumbs-crumb" href="/chromiumos/platform/ec/+/08f5a1e6fc2c9467230444ac9b582dcf4d9f0068">08f5a1e6fc2c9467230444ac9b582dcf4d9f0068</a> / <a class="Breadcrumbs-crumb" href="/chromiumos/platform/ec/+/08f5a1e6fc2c9467230444ac9b582dcf4d9f0068/">.</a> / <a class="Breadcrumbs-crumb" href="/chromiumos/platform/ec/+/08f5a1e6fc2c9467230444ac9b582dcf4d9f0068/driver">driver</a> / <a class="Breadcrumbs-crumb" href="/chromiumos/platform/ec/+/08f5a1e6fc2c9467230444ac9b582dcf4d9f0068/driver/battery">battery</a> / <span class="Breadcrumbs-crumb">max17055.c</span></div><div class="u-sha1 u-monospace BlobSha1">blob: bb0b941937773b4d366a48e30c0454341549a9ad [<a href="/chromiumos/platform/ec/+/08f5a1e6fc2c9467230444ac9b582dcf4d9f0068/driver/battery/max17055.c">file</a>] [<a href="/chromiumos/platform/ec/+log/08f5a1e6fc2c9467230444ac9b582dcf4d9f0068/driver/battery/max17055.c">log</a>] [<a href="/chromiumos/platform/ec/+blame/08f5a1e6fc2c9467230444ac9b582dcf4d9f0068/driver/battery/max17055.c">blame</a>]</div><table class="FileContents"><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="1"></td><td class="FileContents-lineContents" id="1"><span class="com">/* Copyright 2017 The Chromium OS Authors. All rights reserved.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="2"></td><td class="FileContents-lineContents" id="2"><span class="com"> * Use of this source code is governed by a BSD-style license that can be</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="3"></td><td class="FileContents-lineContents" id="3"><span class="com"> * found in the LICENSE file.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="4"></td><td class="FileContents-lineContents" id="4"><span class="com"> *</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="5"></td><td class="FileContents-lineContents" id="5"><span class="com"> * Battery driver for MAX17055.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="6"></td><td class="FileContents-lineContents" id="6"><span class="com"> */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="7"></td><td class="FileContents-lineContents" id="7"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="8"></td><td class="FileContents-lineContents" id="8"><span class="com">#include</span><span class="pln"> </span><span class="str">&quot;battery.h&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="9"></td><td class="FileContents-lineContents" id="9"><span class="com">#include</span><span class="pln"> </span><span class="str">&quot;console.h&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="10"></td><td class="FileContents-lineContents" id="10"><span class="com">#include</span><span class="pln"> </span><span class="str">&quot;extpower.h&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="11"></td><td class="FileContents-lineContents" id="11"><span class="com">#include</span><span class="pln"> </span><span class="str">&quot;hooks.h&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="12"></td><td class="FileContents-lineContents" id="12"><span class="com">#include</span><span class="pln"> </span><span class="str">&quot;i2c.h&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="13"></td><td class="FileContents-lineContents" id="13"><span class="com">#include</span><span class="pln"> </span><span class="str">&quot;max17055.h&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="14"></td><td class="FileContents-lineContents" id="14"><span class="com">#include</span><span class="pln"> </span><span class="str">&quot;printf.h&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="15"></td><td class="FileContents-lineContents" id="15"><span class="com">#include</span><span class="pln"> </span><span class="str">&quot;timer.h&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="16"></td><td class="FileContents-lineContents" id="16"><span class="com">#include</span><span class="pln"> </span><span class="str">&quot;util.h&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="17"></td><td class="FileContents-lineContents" id="17"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="18"></td><td class="FileContents-lineContents" id="18"><span class="com">/* Console output macros */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="19"></td><td class="FileContents-lineContents" id="19"><span class="com">#define</span><span class="pln"> CPRINTS</span><span class="pun">(</span><span class="pln">format</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">...)</span><span class="pln"> cprints</span><span class="pun">(</span><span class="pln">CC_CHARGER</span><span class="pun">,</span><span class="pln"> format</span><span class="pun">,</span><span class="pln"> </span><span class="com">## args)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="20"></td><td class="FileContents-lineContents" id="20"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="21"></td><td class="FileContents-lineContents" id="21"><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="22"></td><td class="FileContents-lineContents" id="22"><span class="com"> * For max17055 to finish battery presence detection, this is the minimal time</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="23"></td><td class="FileContents-lineContents" id="23"><span class="com"> * we have to wait since the last POR. LSB = 175ms.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="24"></td><td class="FileContents-lineContents" id="24"><span class="com"> */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="25"></td><td class="FileContents-lineContents" id="25"><span class="com">#define</span><span class="pln"> RELIABLE_BATT_DETECT_TIME	</span><span class="lit">0x10</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="26"></td><td class="FileContents-lineContents" id="26"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="27"></td><td class="FileContents-lineContents" id="27"><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="28"></td><td class="FileContents-lineContents" id="28"><span class="com"> * Convert the register values to the units that match</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="29"></td><td class="FileContents-lineContents" id="29"><span class="com"> * smart battery protocol.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="30"></td><td class="FileContents-lineContents" id="30"><span class="com"> */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="31"></td><td class="FileContents-lineContents" id="31"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="32"></td><td class="FileContents-lineContents" id="32"><span class="com">/* Voltage reg value to mV */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="33"></td><td class="FileContents-lineContents" id="33"><span class="com">#define</span><span class="pln"> VOLTAGE_CONV</span><span class="pun">(</span><span class="pln">REG</span><span class="pun">)</span><span class="pln">       </span><span class="pun">((</span><span class="pln">REG </span><span class="pun">*</span><span class="pln"> </span><span class="lit">5</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">6</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="34"></td><td class="FileContents-lineContents" id="34"><span class="com">/* Current reg value to mA */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="35"></td><td class="FileContents-lineContents" id="35"><span class="com">#define</span><span class="pln"> CURRENT_CONV</span><span class="pun">(</span><span class="pln">REG</span><span class="pun">)</span><span class="pln">       </span><span class="pun">(((</span><span class="pln">REG </span><span class="pun">*</span><span class="pln"> </span><span class="lit">25</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> BATTERY_MAX17055_RSENSE</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="36"></td><td class="FileContents-lineContents" id="36"><span class="com">/* Capacity reg value to mAh */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="37"></td><td class="FileContents-lineContents" id="37"><span class="com">#define</span><span class="pln"> CAPACITY_CONV</span><span class="pun">(</span><span class="pln">REG</span><span class="pun">)</span><span class="pln">      </span><span class="pun">(</span><span class="pln">REG </span><span class="pun">*</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> BATTERY_MAX17055_RSENSE</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="38"></td><td class="FileContents-lineContents" id="38"><span class="com">/* Time reg value to minute */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="39"></td><td class="FileContents-lineContents" id="39"><span class="com">#define</span><span class="pln"> TIME_CONV</span><span class="pun">(</span><span class="pln">REG</span><span class="pun">)</span><span class="pln">          </span><span class="pun">((</span><span class="pln">REG </span><span class="pun">*</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">5</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="40"></td><td class="FileContents-lineContents" id="40"><span class="com">/* Temperature reg value to 0.1K */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="41"></td><td class="FileContents-lineContents" id="41"><span class="com">#define</span><span class="pln"> TEMPERATURE_CONV</span><span class="pun">(</span><span class="pln">REG</span><span class="pun">)</span><span class="pln">   </span><span class="pun">(((</span><span class="pln">REG </span><span class="pun">*</span><span class="pln"> </span><span class="lit">10</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2731</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="42"></td><td class="FileContents-lineContents" id="42"><span class="com">/* Percentage reg value to 1% */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="43"></td><td class="FileContents-lineContents" id="43"><span class="com">#define</span><span class="pln"> PERCENTAGE_CONV</span><span class="pun">(</span><span class="pln">REG</span><span class="pun">)</span><span class="pln">    </span><span class="pun">(</span><span class="pln">REG </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">8</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="44"></td><td class="FileContents-lineContents" id="44"><span class="com">/* Cycle count reg value (LSB = 1%) to absolute count (100%) */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="45"></td><td class="FileContents-lineContents" id="45"><span class="com">#define</span><span class="pln"> CYCLE_COUNT_CONV</span><span class="pun">(</span><span class="pln">REG</span><span class="pun">)</span><span class="pln">	</span><span class="pun">((</span><span class="pln">REG </span><span class="pun">*</span><span class="pln"> </span><span class="lit">5</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">9</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="46"></td><td class="FileContents-lineContents" id="46"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="47"></td><td class="FileContents-lineContents" id="47"><span class="com">/* Useful macros */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="48"></td><td class="FileContents-lineContents" id="48"><span class="com">#define</span><span class="pln"> MAX17055_READ_DEBUG</span><span class="pun">(</span><span class="pln">offset</span><span class="pun">,</span><span class="pln"> ptr_reg</span><span class="pun">)</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="49"></td><td class="FileContents-lineContents" id="49"><span class="pln">	</span><span class="kwd">do</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="50"></td><td class="FileContents-lineContents" id="50"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">offset</span><span class="pun">,</span><span class="pln"> ptr_reg</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="51"></td><td class="FileContents-lineContents" id="51"><span class="pln">			CPRINTS</span><span class="pun">(</span><span class="str">&quot;%s: failed to read reg %02x&quot;</span><span class="pun">,</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="52"></td><td class="FileContents-lineContents" id="52"><span class="pln">				__func__</span><span class="pun">,</span><span class="pln"> offset</span><span class="pun">);</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="53"></td><td class="FileContents-lineContents" id="53"><span class="pln">			</span><span class="kwd">return</span><span class="pun">;</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="54"></td><td class="FileContents-lineContents" id="54"><span class="pln">		</span><span class="pun">}</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="55"></td><td class="FileContents-lineContents" id="55"><span class="pln">	</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="56"></td><td class="FileContents-lineContents" id="56"><span class="com">#define</span><span class="pln"> MAX17055_WRITE_DEBUG</span><span class="pun">(</span><span class="pln">offset</span><span class="pun">,</span><span class="pln"> reg</span><span class="pun">)</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="57"></td><td class="FileContents-lineContents" id="57"><span class="pln">	</span><span class="kwd">do</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="58"></td><td class="FileContents-lineContents" id="58"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">offset</span><span class="pun">,</span><span class="pln"> reg</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="59"></td><td class="FileContents-lineContents" id="59"><span class="pln">			CPRINTS</span><span class="pun">(</span><span class="str">&quot;%s: failed to read reg %02x&quot;</span><span class="pun">,</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="60"></td><td class="FileContents-lineContents" id="60"><span class="pln">				__func__</span><span class="pun">,</span><span class="pln"> offset</span><span class="pun">);</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="61"></td><td class="FileContents-lineContents" id="61"><span class="pln">			</span><span class="kwd">return</span><span class="pun">;</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="62"></td><td class="FileContents-lineContents" id="62"><span class="pln">		</span><span class="pun">}</span><span class="pln"> \</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="63"></td><td class="FileContents-lineContents" id="63"><span class="pln">	</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="64"></td><td class="FileContents-lineContents" id="64"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="65"></td><td class="FileContents-lineContents" id="65"><span class="kwd">static</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> fake_state_of_charge </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="66"></td><td class="FileContents-lineContents" id="66"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="67"></td><td class="FileContents-lineContents" id="67"><span class="kwd">static</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> max17055_read</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> offset</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">data</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="68"></td><td class="FileContents-lineContents" id="68"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="69"></td><td class="FileContents-lineContents" id="69"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> i2c_read16</span><span class="pun">(</span><span class="pln">I2C_PORT_BATTERY</span><span class="pun">,</span><span class="pln"> MAX17055_ADDR_FLAGS</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="70"></td><td class="FileContents-lineContents" id="70"><span class="pln">			  offset</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="71"></td><td class="FileContents-lineContents" id="71"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="72"></td><td class="FileContents-lineContents" id="72"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="73"></td><td class="FileContents-lineContents" id="73"><span class="kwd">static</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> max17055_write</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> offset</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> data</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="74"></td><td class="FileContents-lineContents" id="74"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="75"></td><td class="FileContents-lineContents" id="75"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> i2c_write16</span><span class="pun">(</span><span class="pln">I2C_PORT_BATTERY</span><span class="pun">,</span><span class="pln"> MAX17055_ADDR_FLAGS</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="76"></td><td class="FileContents-lineContents" id="76"><span class="pln">			   offset</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="77"></td><td class="FileContents-lineContents" id="77"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="78"></td><td class="FileContents-lineContents" id="78"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="79"></td><td class="FileContents-lineContents" id="79"><span class="com">/* Return 1 if the device id is correct. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="80"></td><td class="FileContents-lineContents" id="80"><span class="kwd">static</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> max17055_probe</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="81"></td><td class="FileContents-lineContents" id="81"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="82"></td><td class="FileContents-lineContents" id="82"><span class="pln">	</span><span class="typ">int</span><span class="pln"> dev_id</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="83"></td><td class="FileContents-lineContents" id="83"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="84"></td><td class="FileContents-lineContents" id="84"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_DEVICE_NAME</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">dev_id</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="85"></td><td class="FileContents-lineContents" id="85"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="86"></td><td class="FileContents-lineContents" id="86"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dev_id </span><span class="pun">==</span><span class="pln"> MAX17055_DEVICE_ID</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="87"></td><td class="FileContents-lineContents" id="87"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="88"></td><td class="FileContents-lineContents" id="88"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="89"></td><td class="FileContents-lineContents" id="89"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="90"></td><td class="FileContents-lineContents" id="90"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="91"></td><td class="FileContents-lineContents" id="91"><span class="typ">int</span><span class="pln"> battery_device_name</span><span class="pun">(</span><span class="kwd">char</span><span class="pln"> </span><span class="pun">*</span><span class="pln">device_name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> buf_size</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="92"></td><td class="FileContents-lineContents" id="92"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="93"></td><td class="FileContents-lineContents" id="93"><span class="pln">	</span><span class="typ">int</span><span class="pln"> dev_id</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="94"></td><td class="FileContents-lineContents" id="94"><span class="pln">	</span><span class="typ">int</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="95"></td><td class="FileContents-lineContents" id="95"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="96"></td><td class="FileContents-lineContents" id="96"><span class="pln">	rv </span><span class="pun">=</span><span class="pln"> max17055_read</span><span class="pun">(</span><span class="pln">REG_DEVICE_NAME</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">dev_id</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="97"></td><td class="FileContents-lineContents" id="97"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">rv</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="98"></td><td class="FileContents-lineContents" id="98"><span class="pln">		snprintf</span><span class="pun">(</span><span class="pln">device_name</span><span class="pun">,</span><span class="pln"> buf_size</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;0x%04x&quot;</span><span class="pun">,</span><span class="pln"> dev_id</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="99"></td><td class="FileContents-lineContents" id="99"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="100"></td><td class="FileContents-lineContents" id="100"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="101"></td><td class="FileContents-lineContents" id="101"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="102"></td><td class="FileContents-lineContents" id="102"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="103"></td><td class="FileContents-lineContents" id="103"><span class="typ">int</span><span class="pln"> battery_state_of_charge_abs</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">percent</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="104"></td><td class="FileContents-lineContents" id="104"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="105"></td><td class="FileContents-lineContents" id="105"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNIMPLEMENTED</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="106"></td><td class="FileContents-lineContents" id="106"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="107"></td><td class="FileContents-lineContents" id="107"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="108"></td><td class="FileContents-lineContents" id="108"><span class="typ">int</span><span class="pln"> battery_remaining_capacity</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">capacity</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="109"></td><td class="FileContents-lineContents" id="109"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="110"></td><td class="FileContents-lineContents" id="110"><span class="pln">	</span><span class="typ">int</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="111"></td><td class="FileContents-lineContents" id="111"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="112"></td><td class="FileContents-lineContents" id="112"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="113"></td><td class="FileContents-lineContents" id="113"><span class="pln">	rv </span><span class="pun">=</span><span class="pln"> max17055_read</span><span class="pun">(</span><span class="pln">REG_REMAINING_CAPACITY</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="114"></td><td class="FileContents-lineContents" id="114"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">rv</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="115"></td><td class="FileContents-lineContents" id="115"><span class="pln">		</span><span class="pun">*</span><span class="pln">capacity </span><span class="pun">=</span><span class="pln"> CAPACITY_CONV</span><span class="pun">(</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="116"></td><td class="FileContents-lineContents" id="116"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="117"></td><td class="FileContents-lineContents" id="117"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="118"></td><td class="FileContents-lineContents" id="118"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="119"></td><td class="FileContents-lineContents" id="119"><span class="typ">int</span><span class="pln"> battery_full_charge_capacity</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">capacity</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="120"></td><td class="FileContents-lineContents" id="120"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="121"></td><td class="FileContents-lineContents" id="121"><span class="pln">	</span><span class="typ">int</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="122"></td><td class="FileContents-lineContents" id="122"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="123"></td><td class="FileContents-lineContents" id="123"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="124"></td><td class="FileContents-lineContents" id="124"><span class="pln">	rv </span><span class="pun">=</span><span class="pln"> max17055_read</span><span class="pun">(</span><span class="pln">REG_FULL_CHARGE_CAPACITY</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="125"></td><td class="FileContents-lineContents" id="125"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">rv</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="126"></td><td class="FileContents-lineContents" id="126"><span class="pln">		</span><span class="pun">*</span><span class="pln">capacity </span><span class="pun">=</span><span class="pln"> CAPACITY_CONV</span><span class="pun">(</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="127"></td><td class="FileContents-lineContents" id="127"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="128"></td><td class="FileContents-lineContents" id="128"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="129"></td><td class="FileContents-lineContents" id="129"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="130"></td><td class="FileContents-lineContents" id="130"><span class="typ">int</span><span class="pln"> battery_time_to_empty</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">minutes</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="131"></td><td class="FileContents-lineContents" id="131"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="132"></td><td class="FileContents-lineContents" id="132"><span class="pln">	</span><span class="typ">int</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="133"></td><td class="FileContents-lineContents" id="133"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="134"></td><td class="FileContents-lineContents" id="134"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="135"></td><td class="FileContents-lineContents" id="135"><span class="pln">	rv </span><span class="pun">=</span><span class="pln"> max17055_read</span><span class="pun">(</span><span class="pln">REG_TIME_TO_EMPTY</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="136"></td><td class="FileContents-lineContents" id="136"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">rv</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="137"></td><td class="FileContents-lineContents" id="137"><span class="pln">		</span><span class="pun">*</span><span class="pln">minutes </span><span class="pun">=</span><span class="pln"> TIME_CONV</span><span class="pun">(</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="138"></td><td class="FileContents-lineContents" id="138"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="139"></td><td class="FileContents-lineContents" id="139"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="140"></td><td class="FileContents-lineContents" id="140"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="141"></td><td class="FileContents-lineContents" id="141"><span class="typ">int</span><span class="pln"> battery_time_to_full</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">minutes</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="142"></td><td class="FileContents-lineContents" id="142"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="143"></td><td class="FileContents-lineContents" id="143"><span class="pln">	</span><span class="typ">int</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="144"></td><td class="FileContents-lineContents" id="144"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="145"></td><td class="FileContents-lineContents" id="145"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="146"></td><td class="FileContents-lineContents" id="146"><span class="pln">	rv </span><span class="pun">=</span><span class="pln"> max17055_read</span><span class="pun">(</span><span class="pln">REG_TIME_TO_FULL</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="147"></td><td class="FileContents-lineContents" id="147"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">rv</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="148"></td><td class="FileContents-lineContents" id="148"><span class="pln">		</span><span class="pun">*</span><span class="pln">minutes </span><span class="pun">=</span><span class="pln"> TIME_CONV</span><span class="pun">(</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="149"></td><td class="FileContents-lineContents" id="149"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="150"></td><td class="FileContents-lineContents" id="150"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="151"></td><td class="FileContents-lineContents" id="151"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="152"></td><td class="FileContents-lineContents" id="152"><span class="typ">int</span><span class="pln"> battery_cycle_count</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">count</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="153"></td><td class="FileContents-lineContents" id="153"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="154"></td><td class="FileContents-lineContents" id="154"><span class="pln">	</span><span class="typ">int</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="155"></td><td class="FileContents-lineContents" id="155"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="156"></td><td class="FileContents-lineContents" id="156"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="157"></td><td class="FileContents-lineContents" id="157"><span class="pln">	rv </span><span class="pun">=</span><span class="pln"> max17055_read</span><span class="pun">(</span><span class="pln">REG_CYCLE_COUNT</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="158"></td><td class="FileContents-lineContents" id="158"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">rv</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="159"></td><td class="FileContents-lineContents" id="159"><span class="pln">		</span><span class="pun">*</span><span class="pln">count </span><span class="pun">=</span><span class="pln"> CYCLE_COUNT_CONV</span><span class="pun">(</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="160"></td><td class="FileContents-lineContents" id="160"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="161"></td><td class="FileContents-lineContents" id="161"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="162"></td><td class="FileContents-lineContents" id="162"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="163"></td><td class="FileContents-lineContents" id="163"><span class="typ">int</span><span class="pln"> battery_design_capacity</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">capacity</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="164"></td><td class="FileContents-lineContents" id="164"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="165"></td><td class="FileContents-lineContents" id="165"><span class="pln">	</span><span class="typ">int</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="166"></td><td class="FileContents-lineContents" id="166"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="167"></td><td class="FileContents-lineContents" id="167"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="168"></td><td class="FileContents-lineContents" id="168"><span class="pln">	rv </span><span class="pun">=</span><span class="pln"> max17055_read</span><span class="pun">(</span><span class="pln">REG_DESIGN_CAPACITY</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="169"></td><td class="FileContents-lineContents" id="169"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">rv</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="170"></td><td class="FileContents-lineContents" id="170"><span class="pln">		</span><span class="pun">*</span><span class="pln">capacity </span><span class="pun">=</span><span class="pln"> CAPACITY_CONV</span><span class="pun">(</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="171"></td><td class="FileContents-lineContents" id="171"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="172"></td><td class="FileContents-lineContents" id="172"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="173"></td><td class="FileContents-lineContents" id="173"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="174"></td><td class="FileContents-lineContents" id="174"><span class="typ">int</span><span class="pln"> battery_time_at_rate</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> rate</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">minutes</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="175"></td><td class="FileContents-lineContents" id="175"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="176"></td><td class="FileContents-lineContents" id="176"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNIMPLEMENTED</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="177"></td><td class="FileContents-lineContents" id="177"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="178"></td><td class="FileContents-lineContents" id="178"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="179"></td><td class="FileContents-lineContents" id="179"><span class="typ">int</span><span class="pln"> battery_device_chemistry</span><span class="pun">(</span><span class="kwd">char</span><span class="pln"> </span><span class="pun">*</span><span class="pln">dest</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> size</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="180"></td><td class="FileContents-lineContents" id="180"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="181"></td><td class="FileContents-lineContents" id="181"><span class="pln">	strzcpy</span><span class="pun">(</span><span class="pln">dest</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;&lt;unkn&gt;&quot;</span><span class="pun">,</span><span class="pln"> size</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="182"></td><td class="FileContents-lineContents" id="182"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="183"></td><td class="FileContents-lineContents" id="183"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_SUCCESS</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="184"></td><td class="FileContents-lineContents" id="184"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="185"></td><td class="FileContents-lineContents" id="185"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="186"></td><td class="FileContents-lineContents" id="186"><span class="typ">int</span><span class="pln"> battery_serial_number</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">serial</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="187"></td><td class="FileContents-lineContents" id="187"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="188"></td><td class="FileContents-lineContents" id="188"><span class="pln">	</span><span class="com">/* TODO(philipchen): Implement this function. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="189"></td><td class="FileContents-lineContents" id="189"><span class="pln">	</span><span class="pun">*</span><span class="pln">serial </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xFFFFFFFF</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="190"></td><td class="FileContents-lineContents" id="190"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_SUCCESS</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="191"></td><td class="FileContents-lineContents" id="191"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="192"></td><td class="FileContents-lineContents" id="192"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="193"></td><td class="FileContents-lineContents" id="193"><span class="typ">int</span><span class="pln"> battery_manufacture_date</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">year</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">month</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">day</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="194"></td><td class="FileContents-lineContents" id="194"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="195"></td><td class="FileContents-lineContents" id="195"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNIMPLEMENTED</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="196"></td><td class="FileContents-lineContents" id="196"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="197"></td><td class="FileContents-lineContents" id="197"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="198"></td><td class="FileContents-lineContents" id="198"><span class="typ">int</span><span class="pln"> battery_design_voltage</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">voltage</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="199"></td><td class="FileContents-lineContents" id="199"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="200"></td><td class="FileContents-lineContents" id="200"><span class="pln">	</span><span class="pun">*</span><span class="pln">voltage </span><span class="pun">=</span><span class="pln"> battery_get_info</span><span class="pun">()-&gt;</span><span class="pln">voltage_normal</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="201"></td><td class="FileContents-lineContents" id="201"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="202"></td><td class="FileContents-lineContents" id="202"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_SUCCESS</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="203"></td><td class="FileContents-lineContents" id="203"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="204"></td><td class="FileContents-lineContents" id="204"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="205"></td><td class="FileContents-lineContents" id="205"><span class="typ">int</span><span class="pln"> battery_get_mode</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">mode</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="206"></td><td class="FileContents-lineContents" id="206"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="207"></td><td class="FileContents-lineContents" id="207"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNIMPLEMENTED</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="208"></td><td class="FileContents-lineContents" id="208"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="209"></td><td class="FileContents-lineContents" id="209"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="210"></td><td class="FileContents-lineContents" id="210"><span class="typ">int</span><span class="pln"> battery_status</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> </span><span class="pun">*</span><span class="pln">status</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="211"></td><td class="FileContents-lineContents" id="211"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="212"></td><td class="FileContents-lineContents" id="212"><span class="pln">	</span><span class="typ">int</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="213"></td><td class="FileContents-lineContents" id="213"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="214"></td><td class="FileContents-lineContents" id="214"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="215"></td><td class="FileContents-lineContents" id="215"><span class="pln">	</span><span class="pun">*</span><span class="pln">status </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="216"></td><td class="FileContents-lineContents" id="216"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="217"></td><td class="FileContents-lineContents" id="217"><span class="pln">	rv </span><span class="pun">=</span><span class="pln"> max17055_read</span><span class="pun">(</span><span class="pln">REG_FSTAT</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="218"></td><td class="FileContents-lineContents" id="218"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">rv</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="219"></td><td class="FileContents-lineContents" id="219"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="220"></td><td class="FileContents-lineContents" id="220"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">reg </span><span class="pun">&amp;</span><span class="pln"> FSTAT_FQ</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="221"></td><td class="FileContents-lineContents" id="221"><span class="pln">		</span><span class="pun">*</span><span class="pln">status </span><span class="pun">|=</span><span class="pln"> BATTERY_FULLY_CHARGED</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="222"></td><td class="FileContents-lineContents" id="222"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="223"></td><td class="FileContents-lineContents" id="223"><span class="pln">	rv </span><span class="pun">=</span><span class="pln"> max17055_read</span><span class="pun">(</span><span class="pln">REG_AVERAGE_CURRENT</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="224"></td><td class="FileContents-lineContents" id="224"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">rv</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="225"></td><td class="FileContents-lineContents" id="225"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> rv</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="226"></td><td class="FileContents-lineContents" id="226"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">reg </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">15</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="227"></td><td class="FileContents-lineContents" id="227"><span class="pln">		</span><span class="pun">*</span><span class="pln">status </span><span class="pun">|=</span><span class="pln"> BATTERY_DISCHARGING</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="228"></td><td class="FileContents-lineContents" id="228"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="229"></td><td class="FileContents-lineContents" id="229"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_SUCCESS</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="230"></td><td class="FileContents-lineContents" id="230"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="231"></td><td class="FileContents-lineContents" id="231"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="232"></td><td class="FileContents-lineContents" id="232"><span class="kwd">enum</span><span class="pln"> battery_present battery_is_present</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="233"></td><td class="FileContents-lineContents" id="233"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="234"></td><td class="FileContents-lineContents" id="234"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="235"></td><td class="FileContents-lineContents" id="235"><span class="pln">	</span><span class="kwd">static</span><span class="pln"> </span><span class="typ">uint8_t</span><span class="pln"> batt_pres_sure</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="236"></td><td class="FileContents-lineContents" id="236"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="237"></td><td class="FileContents-lineContents" id="237"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_STATUS</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="238"></td><td class="FileContents-lineContents" id="238"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> BP_NOT_SURE</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="239"></td><td class="FileContents-lineContents" id="239"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="240"></td><td class="FileContents-lineContents" id="240"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">reg </span><span class="pun">&amp;</span><span class="pln"> STATUS_BST</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="241"></td><td class="FileContents-lineContents" id="241"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> BP_NO</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="242"></td><td class="FileContents-lineContents" id="242"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="243"></td><td class="FileContents-lineContents" id="243"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">batt_pres_sure</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="244"></td><td class="FileContents-lineContents" id="244"><span class="pln">		</span><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="245"></td><td class="FileContents-lineContents" id="245"><span class="com">		 * The battery detection result is not reliable within</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="246"></td><td class="FileContents-lineContents" id="246"><span class="com">		 * ~2.8 secs since POR.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="247"></td><td class="FileContents-lineContents" id="247"><span class="com">		 */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="248"></td><td class="FileContents-lineContents" id="248"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_TIMERH</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="249"></td><td class="FileContents-lineContents" id="249"><span class="pln">			</span><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="250"></td><td class="FileContents-lineContents" id="250"><span class="com">			 * The LSB of TIMERH reg is 3.2 hrs. If the reg has a</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="251"></td><td class="FileContents-lineContents" id="251"><span class="com">			 * nonzero value, battery detection must have been</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="252"></td><td class="FileContents-lineContents" id="252"><span class="com">			 * settled.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="253"></td><td class="FileContents-lineContents" id="253"><span class="com">			 */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="254"></td><td class="FileContents-lineContents" id="254"><span class="pln">			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">reg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="255"></td><td class="FileContents-lineContents" id="255"><span class="pln">				batt_pres_sure </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="256"></td><td class="FileContents-lineContents" id="256"><span class="pln">				</span><span class="kwd">return</span><span class="pln"> BP_YES</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="257"></td><td class="FileContents-lineContents" id="257"><span class="pln">			</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="258"></td><td class="FileContents-lineContents" id="258"><span class="pln">			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_TIMER</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="259"></td><td class="FileContents-lineContents" id="259"><span class="pln">			    </span><span class="pun">((</span><span class="typ">uint32_t</span><span class="pun">)</span><span class="pln">reg </span><span class="pun">&gt;</span><span class="pln"> RELIABLE_BATT_DETECT_TIME</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="260"></td><td class="FileContents-lineContents" id="260"><span class="pln">				batt_pres_sure </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="261"></td><td class="FileContents-lineContents" id="261"><span class="pln">				</span><span class="kwd">return</span><span class="pln"> BP_YES</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="262"></td><td class="FileContents-lineContents" id="262"><span class="pln">			</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="263"></td><td class="FileContents-lineContents" id="263"><span class="pln">		</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="264"></td><td class="FileContents-lineContents" id="264"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> BP_NOT_SURE</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="265"></td><td class="FileContents-lineContents" id="265"><span class="pln">	</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="266"></td><td class="FileContents-lineContents" id="266"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> BP_YES</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="267"></td><td class="FileContents-lineContents" id="267"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="268"></td><td class="FileContents-lineContents" id="268"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="269"></td><td class="FileContents-lineContents" id="269"><span class="kwd">void</span><span class="pln"> battery_get_params</span><span class="pun">(</span><span class="kwd">struct</span><span class="pln"> batt_params </span><span class="pun">*</span><span class="pln">batt</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="270"></td><td class="FileContents-lineContents" id="270"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="271"></td><td class="FileContents-lineContents" id="271"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="272"></td><td class="FileContents-lineContents" id="272"><span class="pln">	</span><span class="kwd">struct</span><span class="pln"> batt_params batt_new </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="lit">0</span><span class="pun">};</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="273"></td><td class="FileContents-lineContents" id="273"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="274"></td><td class="FileContents-lineContents" id="274"><span class="pln">	</span><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="275"></td><td class="FileContents-lineContents" id="275"><span class="com">	 * Assuming the battery is responsive as long as</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="276"></td><td class="FileContents-lineContents" id="276"><span class="com">	 * max17055 finds battery is present.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="277"></td><td class="FileContents-lineContents" id="277"><span class="com">	 */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="278"></td><td class="FileContents-lineContents" id="278"><span class="pln">	batt_new</span><span class="pun">.</span><span class="pln">is_present </span><span class="pun">=</span><span class="pln"> battery_is_present</span><span class="pun">();</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="279"></td><td class="FileContents-lineContents" id="279"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="280"></td><td class="FileContents-lineContents" id="280"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">batt_new</span><span class="pun">.</span><span class="pln">is_present </span><span class="pun">==</span><span class="pln"> BP_YES</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="281"></td><td class="FileContents-lineContents" id="281"><span class="pln">		batt_new</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">|=</span><span class="pln"> BATT_FLAG_RESPONSIVE</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="282"></td><td class="FileContents-lineContents" id="282"><span class="pln">	</span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">batt_new</span><span class="pun">.</span><span class="pln">is_present </span><span class="pun">==</span><span class="pln"> BP_NO</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="283"></td><td class="FileContents-lineContents" id="283"><span class="pln">		</span><span class="com">/* Battery is not present, gauge won&#39;t report useful info. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="284"></td><td class="FileContents-lineContents" id="284"><span class="pln">		</span><span class="kwd">goto</span><span class="pln"> batt_out</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="285"></td><td class="FileContents-lineContents" id="285"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="286"></td><td class="FileContents-lineContents" id="286"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_TEMPERATURE</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="287"></td><td class="FileContents-lineContents" id="287"><span class="pln">		batt_new</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">|=</span><span class="pln"> BATT_FLAG_BAD_TEMPERATURE</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="288"></td><td class="FileContents-lineContents" id="288"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="289"></td><td class="FileContents-lineContents" id="289"><span class="pln">	batt_new</span><span class="pun">.</span><span class="pln">temperature </span><span class="pun">=</span><span class="pln"> TEMPERATURE_CONV</span><span class="pun">((</span><span class="typ">int16_t</span><span class="pun">)</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="290"></td><td class="FileContents-lineContents" id="290"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="291"></td><td class="FileContents-lineContents" id="291"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_STATE_OF_CHARGE</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="292"></td><td class="FileContents-lineContents" id="292"><span class="pln">	    fake_state_of_charge </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="293"></td><td class="FileContents-lineContents" id="293"><span class="pln">		batt_new</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">|=</span><span class="pln"> BATT_FLAG_BAD_STATE_OF_CHARGE</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="294"></td><td class="FileContents-lineContents" id="294"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="295"></td><td class="FileContents-lineContents" id="295"><span class="pln">	batt_new</span><span class="pun">.</span><span class="pln">state_of_charge </span><span class="pun">=</span><span class="pln"> fake_state_of_charge </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="296"></td><td class="FileContents-lineContents" id="296"><span class="pln">				fake_state_of_charge </span><span class="pun">:</span><span class="pln"> PERCENTAGE_CONV</span><span class="pun">(</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="297"></td><td class="FileContents-lineContents" id="297"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="298"></td><td class="FileContents-lineContents" id="298"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_VOLTAGE</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="299"></td><td class="FileContents-lineContents" id="299"><span class="pln">		batt_new</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">|=</span><span class="pln"> BATT_FLAG_BAD_VOLTAGE</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="300"></td><td class="FileContents-lineContents" id="300"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="301"></td><td class="FileContents-lineContents" id="301"><span class="pln">	batt_new</span><span class="pun">.</span><span class="pln">voltage </span><span class="pun">=</span><span class="pln"> VOLTAGE_CONV</span><span class="pun">(</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="302"></td><td class="FileContents-lineContents" id="302"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="303"></td><td class="FileContents-lineContents" id="303"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_AVERAGE_CURRENT</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="304"></td><td class="FileContents-lineContents" id="304"><span class="pln">		batt_new</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">|=</span><span class="pln"> BATT_FLAG_BAD_CURRENT</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="305"></td><td class="FileContents-lineContents" id="305"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="306"></td><td class="FileContents-lineContents" id="306"><span class="pln">	batt_new</span><span class="pun">.</span><span class="pln">current </span><span class="pun">=</span><span class="pln"> CURRENT_CONV</span><span class="pun">((</span><span class="typ">int16_t</span><span class="pun">)</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="307"></td><td class="FileContents-lineContents" id="307"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="308"></td><td class="FileContents-lineContents" id="308"><span class="pln">	batt_new</span><span class="pun">.</span><span class="pln">desired_voltage </span><span class="pun">=</span><span class="pln"> battery_get_info</span><span class="pun">()-&gt;</span><span class="pln">voltage_max</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="309"></td><td class="FileContents-lineContents" id="309"><span class="pln">	batt_new</span><span class="pun">.</span><span class="pln">desired_current </span><span class="pun">=</span><span class="pln"> BATTERY_DESIRED_CHARGING_CURRENT</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="310"></td><td class="FileContents-lineContents" id="310"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="311"></td><td class="FileContents-lineContents" id="311"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">battery_remaining_capacity</span><span class="pun">(&amp;</span><span class="pln">batt_new</span><span class="pun">.</span><span class="pln">remaining_capacity</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="312"></td><td class="FileContents-lineContents" id="312"><span class="pln">		batt_new</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">|=</span><span class="pln"> BATT_FLAG_BAD_REMAINING_CAPACITY</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="313"></td><td class="FileContents-lineContents" id="313"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="314"></td><td class="FileContents-lineContents" id="314"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">battery_full_charge_capacity</span><span class="pun">(&amp;</span><span class="pln">batt_new</span><span class="pun">.</span><span class="pln">full_capacity</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="315"></td><td class="FileContents-lineContents" id="315"><span class="pln">		batt_new</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">|=</span><span class="pln"> BATT_FLAG_BAD_FULL_CAPACITY</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="316"></td><td class="FileContents-lineContents" id="316"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="317"></td><td class="FileContents-lineContents" id="317"><span class="pln">	</span><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="318"></td><td class="FileContents-lineContents" id="318"><span class="com">	 * Charging allowed if both desired voltage and current are nonzero</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="319"></td><td class="FileContents-lineContents" id="319"><span class="com">	 * and battery isn&#39;t full (and we read them all correctly).</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="320"></td><td class="FileContents-lineContents" id="320"><span class="com">	 */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="321"></td><td class="FileContents-lineContents" id="321"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!(</span><span class="pln">batt_new</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">&amp;</span><span class="pln"> BATT_FLAG_BAD_STATE_OF_CHARGE</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="322"></td><td class="FileContents-lineContents" id="322"><span class="pln">	    batt_new</span><span class="pun">.</span><span class="pln">desired_voltage </span><span class="pun">&amp;&amp;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="323"></td><td class="FileContents-lineContents" id="323"><span class="pln">	    batt_new</span><span class="pun">.</span><span class="pln">desired_current </span><span class="pun">&amp;&amp;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="324"></td><td class="FileContents-lineContents" id="324"><span class="pln">	    batt_new</span><span class="pun">.</span><span class="pln">state_of_charge </span><span class="pun">&lt;</span><span class="pln"> BATTERY_LEVEL_FULL</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="325"></td><td class="FileContents-lineContents" id="325"><span class="pln">		batt_new</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">|=</span><span class="pln"> BATT_FLAG_WANT_CHARGE</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="326"></td><td class="FileContents-lineContents" id="326"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="327"></td><td class="FileContents-lineContents" id="327"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">battery_status</span><span class="pun">(&amp;</span><span class="pln">batt_new</span><span class="pun">.</span><span class="pln">status</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="328"></td><td class="FileContents-lineContents" id="328"><span class="pln">		batt_new</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">|=</span><span class="pln"> BATT_FLAG_BAD_STATUS</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="329"></td><td class="FileContents-lineContents" id="329"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="330"></td><td class="FileContents-lineContents" id="330"><span class="pln">batt_out</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="331"></td><td class="FileContents-lineContents" id="331"><span class="pln">	</span><span class="com">/* Update visible battery parameters */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="332"></td><td class="FileContents-lineContents" id="332"><span class="pln">	memcpy</span><span class="pun">(</span><span class="pln">batt</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">batt_new</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(*</span><span class="pln">batt</span><span class="pun">));</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="333"></td><td class="FileContents-lineContents" id="333"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="334"></td><td class="FileContents-lineContents" id="334"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="335"></td><td class="FileContents-lineContents" id="335"><span class="com">#ifdef</span><span class="pln"> CONFIG_CMD_PWR_AVG</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="336"></td><td class="FileContents-lineContents" id="336"><span class="typ">int</span><span class="pln"> battery_get_avg_current</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="337"></td><td class="FileContents-lineContents" id="337"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="338"></td><td class="FileContents-lineContents" id="338"><span class="pln">	</span><span class="com">/* TODO(crbug.com/752320) implement this */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="339"></td><td class="FileContents-lineContents" id="339"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNIMPLEMENTED</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="340"></td><td class="FileContents-lineContents" id="340"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="341"></td><td class="FileContents-lineContents" id="341"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="342"></td><td class="FileContents-lineContents" id="342"><span class="typ">int</span><span class="pln"> battery_get_avg_voltage</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="343"></td><td class="FileContents-lineContents" id="343"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="344"></td><td class="FileContents-lineContents" id="344"><span class="pln">	</span><span class="com">/* TODO(crbug.com/752320) implement this */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="345"></td><td class="FileContents-lineContents" id="345"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> </span><span class="pun">-</span><span class="pln">EC_ERROR_UNIMPLEMENTED</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="346"></td><td class="FileContents-lineContents" id="346"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="347"></td><td class="FileContents-lineContents" id="347"><span class="com">#endif</span><span class="pln"> </span><span class="com">/* CONFIG_CMD_PWR_AVG */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="348"></td><td class="FileContents-lineContents" id="348"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="349"></td><td class="FileContents-lineContents" id="349"><span class="com">/* Wait until battery is totally stable. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="350"></td><td class="FileContents-lineContents" id="350"><span class="typ">int</span><span class="pln"> battery_wait_for_stable</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="351"></td><td class="FileContents-lineContents" id="351"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="352"></td><td class="FileContents-lineContents" id="352"><span class="pln">	</span><span class="com">/* TODO(philipchen): Implement this function. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="353"></td><td class="FileContents-lineContents" id="353"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_SUCCESS</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="354"></td><td class="FileContents-lineContents" id="354"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="355"></td><td class="FileContents-lineContents" id="355"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="356"></td><td class="FileContents-lineContents" id="356"><span class="kwd">static</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> max17055_poll_flag_clear</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> regno</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> mask</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> timeout</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="357"></td><td class="FileContents-lineContents" id="357"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="358"></td><td class="FileContents-lineContents" id="358"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="359"></td><td class="FileContents-lineContents" id="359"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="360"></td><td class="FileContents-lineContents" id="360"><span class="pln">	</span><span class="kwd">do</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="361"></td><td class="FileContents-lineContents" id="361"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">regno</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="362"></td><td class="FileContents-lineContents" id="362"><span class="pln">			</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="363"></td><td class="FileContents-lineContents" id="363"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="364"></td><td class="FileContents-lineContents" id="364"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!(</span><span class="pln">mask </span><span class="pun">&amp;</span><span class="pln"> reg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="365"></td><td class="FileContents-lineContents" id="365"><span class="pln">			</span><span class="kwd">return</span><span class="pln"> EC_SUCCESS</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="366"></td><td class="FileContents-lineContents" id="366"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="367"></td><td class="FileContents-lineContents" id="367"><span class="pln">		msleep</span><span class="pun">(</span><span class="lit">10</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="368"></td><td class="FileContents-lineContents" id="368"><span class="pln">		timeout </span><span class="pun">-=</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="369"></td><td class="FileContents-lineContents" id="369"><span class="pln">	</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">timeout </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="370"></td><td class="FileContents-lineContents" id="370"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="371"></td><td class="FileContents-lineContents" id="371"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_ERROR_TIMEOUT</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="372"></td><td class="FileContents-lineContents" id="372"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="373"></td><td class="FileContents-lineContents" id="373"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="374"></td><td class="FileContents-lineContents" id="374"><span class="kwd">static</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> max17055_load_ocv_table</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">struct</span><span class="pln"> max17055_batt_profile </span><span class="pun">*</span><span class="pln">config</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="375"></td><td class="FileContents-lineContents" id="375"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="376"></td><td class="FileContents-lineContents" id="376"><span class="pln">	</span><span class="typ">int</span><span class="pln"> i</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="377"></td><td class="FileContents-lineContents" id="377"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="378"></td><td class="FileContents-lineContents" id="378"><span class="pln">	</span><span class="typ">int</span><span class="pln"> retries </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="379"></td><td class="FileContents-lineContents" id="379"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="380"></td><td class="FileContents-lineContents" id="380"><span class="pln">	</span><span class="com">/* Unlock ocv table */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="381"></td><td class="FileContents-lineContents" id="381"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_LOCK1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0x0059</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="382"></td><td class="FileContents-lineContents" id="382"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_LOCK2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0x00c4</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="383"></td><td class="FileContents-lineContents" id="383"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="384"></td><td class="FileContents-lineContents" id="384"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="385"></td><td class="FileContents-lineContents" id="385"><span class="pln">	ASSERT</span><span class="pun">(</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">ocv_table</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="386"></td><td class="FileContents-lineContents" id="386"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="387"></td><td class="FileContents-lineContents" id="387"><span class="pln">	</span><span class="com">/* Write ocv data */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="388"></td><td class="FileContents-lineContents" id="388"><span class="pln">	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> MAX17055_OCV_TABLE_SIZE</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="389"></td><td class="FileContents-lineContents" id="389"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_OCV_TABLE_START </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="390"></td><td class="FileContents-lineContents" id="390"><span class="pln">				   config</span><span class="pun">-&gt;</span><span class="pln">ocv_table</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="391"></td><td class="FileContents-lineContents" id="391"><span class="pln">			</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="392"></td><td class="FileContents-lineContents" id="392"><span class="pln">	</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="393"></td><td class="FileContents-lineContents" id="393"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="394"></td><td class="FileContents-lineContents" id="394"><span class="pln">	</span><span class="com">/* Read and compare ocv data */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="395"></td><td class="FileContents-lineContents" id="395"><span class="pln">	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> MAX17055_OCV_TABLE_SIZE</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="396"></td><td class="FileContents-lineContents" id="396"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_OCV_TABLE_START </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="397"></td><td class="FileContents-lineContents" id="397"><span class="pln">		    reg </span><span class="pun">!=</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">ocv_table</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="398"></td><td class="FileContents-lineContents" id="398"><span class="pln">			</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="399"></td><td class="FileContents-lineContents" id="399"><span class="pln">	</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="400"></td><td class="FileContents-lineContents" id="400"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="401"></td><td class="FileContents-lineContents" id="401"><span class="pln">	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(--</span><span class="pln">retries</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="402"></td><td class="FileContents-lineContents" id="402"><span class="pln">		</span><span class="com">/* Lock ocv table */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="403"></td><td class="FileContents-lineContents" id="403"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_LOCK1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0x0000</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="404"></td><td class="FileContents-lineContents" id="404"><span class="pln">		    max17055_write</span><span class="pun">(</span><span class="pln">REG_LOCK2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0x0000</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="405"></td><td class="FileContents-lineContents" id="405"><span class="pln">			</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="406"></td><td class="FileContents-lineContents" id="406"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="407"></td><td class="FileContents-lineContents" id="407"><span class="pln">		</span><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="408"></td><td class="FileContents-lineContents" id="408"><span class="com">		 * If the ocv table remains unlocked, the MAX17055 cannot</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="409"></td><td class="FileContents-lineContents" id="409"><span class="com">		 * monitor the capacity of the battery. Therefore, it is very</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="410"></td><td class="FileContents-lineContents" id="410"><span class="com">		 * critical that the ocv table is locked. To verify it is</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="411"></td><td class="FileContents-lineContents" id="411"><span class="com">		 * locked, simply read back the values. However, this time,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="412"></td><td class="FileContents-lineContents" id="412"><span class="com">		 * all values should be read as 0x0000.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="413"></td><td class="FileContents-lineContents" id="413"><span class="com">		 */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="414"></td><td class="FileContents-lineContents" id="414"><span class="pln">		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> MAX17055_OCV_TABLE_SIZE</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="415"></td><td class="FileContents-lineContents" id="415"><span class="pln">			reg </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="416"></td><td class="FileContents-lineContents" id="416"><span class="pln">			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_OCV_TABLE_START </span><span class="pun">+</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="417"></td><td class="FileContents-lineContents" id="417"><span class="pln">				</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="418"></td><td class="FileContents-lineContents" id="418"><span class="pln">			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">reg</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="419"></td><td class="FileContents-lineContents" id="419"><span class="pln">				</span><span class="kwd">break</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="420"></td><td class="FileContents-lineContents" id="420"><span class="pln">		</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="421"></td><td class="FileContents-lineContents" id="421"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">==</span><span class="pln"> MAX17055_OCV_TABLE_SIZE</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="422"></td><td class="FileContents-lineContents" id="422"><span class="pln">			</span><span class="kwd">break</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="423"></td><td class="FileContents-lineContents" id="423"><span class="pln">		msleep</span><span class="pun">(</span><span class="lit">20</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="424"></td><td class="FileContents-lineContents" id="424"><span class="pln">	</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="425"></td><td class="FileContents-lineContents" id="425"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">retries</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="426"></td><td class="FileContents-lineContents" id="426"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_TIMEOUT</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="427"></td><td class="FileContents-lineContents" id="427"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="428"></td><td class="FileContents-lineContents" id="428"><span class="pln">	</span><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="429"></td><td class="FileContents-lineContents" id="429"><span class="com">	 * Delay 180ms is to prepare the environment to load the custom</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="430"></td><td class="FileContents-lineContents" id="430"><span class="com">	 * battery parameters. Otherwise, the initialization operation</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="431"></td><td class="FileContents-lineContents" id="431"><span class="com">	 * has a very small probability of failure.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="432"></td><td class="FileContents-lineContents" id="432"><span class="com">	 */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="433"></td><td class="FileContents-lineContents" id="433"><span class="pln">	msleep</span><span class="pun">(</span><span class="lit">180</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="434"></td><td class="FileContents-lineContents" id="434"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="435"></td><td class="FileContents-lineContents" id="435"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_SUCCESS</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="436"></td><td class="FileContents-lineContents" id="436"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="437"></td><td class="FileContents-lineContents" id="437"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="438"></td><td class="FileContents-lineContents" id="438"><span class="kwd">static</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> max17055_exit_hibernate</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="439"></td><td class="FileContents-lineContents" id="439"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="440"></td><td class="FileContents-lineContents" id="440"><span class="pln">	</span><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="441"></td><td class="FileContents-lineContents" id="441"><span class="com">	 * Write REG_COMMAND with 0x90 to force the firmware to stop running.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="442"></td><td class="FileContents-lineContents" id="442"><span class="com">	 * Write REG_HIBCFG with 0x00 to exit hibernate mode immediately.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="443"></td><td class="FileContents-lineContents" id="443"><span class="com">	 * Write REG_COMMAND with 0x00 to run the firmware again.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="444"></td><td class="FileContents-lineContents" id="444"><span class="com">	 */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="445"></td><td class="FileContents-lineContents" id="445"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_COMMAND</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0x90</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="446"></td><td class="FileContents-lineContents" id="446"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_HIBCFG</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0x00</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="447"></td><td class="FileContents-lineContents" id="447"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_COMMAND</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0x00</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="448"></td><td class="FileContents-lineContents" id="448"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="449"></td><td class="FileContents-lineContents" id="449"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="450"></td><td class="FileContents-lineContents" id="450"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_SUCCESS</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="451"></td><td class="FileContents-lineContents" id="451"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="452"></td><td class="FileContents-lineContents" id="452"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="453"></td><td class="FileContents-lineContents" id="453"><span class="com">/* Configured MAX17055 with the battery parameters for full model. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="454"></td><td class="FileContents-lineContents" id="454"><span class="kwd">static</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> max17055_load_batt_model_full</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="455"></td><td class="FileContents-lineContents" id="455"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="456"></td><td class="FileContents-lineContents" id="456"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="457"></td><td class="FileContents-lineContents" id="457"><span class="pln">	</span><span class="typ">int</span><span class="pln"> hib_cfg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="458"></td><td class="FileContents-lineContents" id="458"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="459"></td><td class="FileContents-lineContents" id="459"><span class="pln">	</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">struct</span><span class="pln"> max17055_batt_profile </span><span class="pun">*</span><span class="pln">config</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="460"></td><td class="FileContents-lineContents" id="460"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="461"></td><td class="FileContents-lineContents" id="461"><span class="pln">	config </span><span class="pun">=</span><span class="pln"> max17055_get_batt_profile</span><span class="pun">();</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="462"></td><td class="FileContents-lineContents" id="462"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="463"></td><td class="FileContents-lineContents" id="463"><span class="pln">	</span><span class="com">/* Store the original HibCFG value. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="464"></td><td class="FileContents-lineContents" id="464"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_HIBCFG</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">hib_cfg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="465"></td><td class="FileContents-lineContents" id="465"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="466"></td><td class="FileContents-lineContents" id="466"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="467"></td><td class="FileContents-lineContents" id="467"><span class="pln">	</span><span class="com">/* Force exit from hibernate */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="468"></td><td class="FileContents-lineContents" id="468"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_exit_hibernate</span><span class="pun">())</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="469"></td><td class="FileContents-lineContents" id="469"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="470"></td><td class="FileContents-lineContents" id="470"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="471"></td><td class="FileContents-lineContents" id="471"><span class="pln">	</span><span class="com">/* Write LearnCFG with LS 7 */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="472"></td><td class="FileContents-lineContents" id="472"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_LEARNCFG</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">learn_cfg </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0x0070</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="473"></td><td class="FileContents-lineContents" id="473"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="474"></td><td class="FileContents-lineContents" id="474"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="475"></td><td class="FileContents-lineContents" id="475"><span class="pln">	</span><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="476"></td><td class="FileContents-lineContents" id="476"><span class="com">	 * Unlock ocv table access, write/compare/verify custom ocv table,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="477"></td><td class="FileContents-lineContents" id="477"><span class="com">	 * lock ocv table access.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="478"></td><td class="FileContents-lineContents" id="478"><span class="com">	 */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="479"></td><td class="FileContents-lineContents" id="479"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_load_ocv_table</span><span class="pun">(</span><span class="pln">config</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="480"></td><td class="FileContents-lineContents" id="480"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="481"></td><td class="FileContents-lineContents" id="481"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="482"></td><td class="FileContents-lineContents" id="482"><span class="pln">	</span><span class="com">/* Write custom parameters */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="483"></td><td class="FileContents-lineContents" id="483"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_DESIGN_CAPACITY</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">design_cap</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="484"></td><td class="FileContents-lineContents" id="484"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_DQACC</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">design_cap </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="485"></td><td class="FileContents-lineContents" id="485"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_DPACC</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0x0c80</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="486"></td><td class="FileContents-lineContents" id="486"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_CHARGE_TERM_CURRENT</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">ichg_term</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="487"></td><td class="FileContents-lineContents" id="487"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_EMPTY_VOLTAGE</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">v_empty_detect</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="488"></td><td class="FileContents-lineContents" id="488"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="489"></td><td class="FileContents-lineContents" id="489"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="490"></td><td class="FileContents-lineContents" id="490"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_RCOMP0</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">rcomp0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="491"></td><td class="FileContents-lineContents" id="491"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_TEMPCO</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">tempco</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="492"></td><td class="FileContents-lineContents" id="492"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_QR_TABLE00</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">qr_table00</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="493"></td><td class="FileContents-lineContents" id="493"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_QR_TABLE10</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">qr_table10</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="494"></td><td class="FileContents-lineContents" id="494"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="495"></td><td class="FileContents-lineContents" id="495"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="496"></td><td class="FileContents-lineContents" id="496"><span class="pln">	</span><span class="com">/* Update required capacity registers */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="497"></td><td class="FileContents-lineContents" id="497"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_REMAINING_CAPACITY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0x0000</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="498"></td><td class="FileContents-lineContents" id="498"><span class="pln">	    max17055_read</span><span class="pun">(</span><span class="pln">REG_VFSOC</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="499"></td><td class="FileContents-lineContents" id="499"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="500"></td><td class="FileContents-lineContents" id="500"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="501"></td><td class="FileContents-lineContents" id="501"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_VFSOC0</span><span class="pun">,</span><span class="pln"> reg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="502"></td><td class="FileContents-lineContents" id="502"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_FULL_CHARGE_CAPACITY</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">design_cap</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="503"></td><td class="FileContents-lineContents" id="503"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_FULLCAPNOM</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">design_cap</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="504"></td><td class="FileContents-lineContents" id="504"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="505"></td><td class="FileContents-lineContents" id="505"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="506"></td><td class="FileContents-lineContents" id="506"><span class="pln">	</span><span class="com">/* Prepare to Load Model */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="507"></td><td class="FileContents-lineContents" id="507"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_REMAINING_CAPACITY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0x0000</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="508"></td><td class="FileContents-lineContents" id="508"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_MIXCAP</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">design_cap</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="509"></td><td class="FileContents-lineContents" id="509"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="510"></td><td class="FileContents-lineContents" id="510"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="511"></td><td class="FileContents-lineContents" id="511"><span class="pln">	</span><span class="com">/* Initiate model loading */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="512"></td><td class="FileContents-lineContents" id="512"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_CONFIG2</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="513"></td><td class="FileContents-lineContents" id="513"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_CONFIG2</span><span class="pun">,</span><span class="pln"> reg </span><span class="pun">|</span><span class="pln"> CONFIG2_LDMDL</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="514"></td><td class="FileContents-lineContents" id="514"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="515"></td><td class="FileContents-lineContents" id="515"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="516"></td><td class="FileContents-lineContents" id="516"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_poll_flag_clear</span><span class="pun">(</span><span class="pln">REG_CONFIG2</span><span class="pun">,</span><span class="pln"> CONFIG2_LDMDL</span><span class="pun">,</span><span class="pln"> </span><span class="lit">500</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="517"></td><td class="FileContents-lineContents" id="517"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="518"></td><td class="FileContents-lineContents" id="518"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="519"></td><td class="FileContents-lineContents" id="519"><span class="pln">	</span><span class="com">/* Write LearnCFG with LS 0 */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="520"></td><td class="FileContents-lineContents" id="520"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_LEARNCFG</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">learn_cfg </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff8f</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="521"></td><td class="FileContents-lineContents" id="521"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_QR_TABLE20</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">qr_table20</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="522"></td><td class="FileContents-lineContents" id="522"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_QR_TABLE30</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">qr_table30</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="523"></td><td class="FileContents-lineContents" id="523"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="524"></td><td class="FileContents-lineContents" id="524"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="525"></td><td class="FileContents-lineContents" id="525"><span class="pln">	</span><span class="com">/* Restore the original HibCFG value. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="526"></td><td class="FileContents-lineContents" id="526"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_HIBCFG</span><span class="pun">,</span><span class="pln"> hib_cfg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="527"></td><td class="FileContents-lineContents" id="527"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="528"></td><td class="FileContents-lineContents" id="528"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="529"></td><td class="FileContents-lineContents" id="529"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_SUCCESS</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="530"></td><td class="FileContents-lineContents" id="530"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="531"></td><td class="FileContents-lineContents" id="531"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="532"></td><td class="FileContents-lineContents" id="532"><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="533"></td><td class="FileContents-lineContents" id="533"><span class="com"> * Configured MAX17055 with the battery parameters for short model or ez model</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="534"></td><td class="FileContents-lineContents" id="534"><span class="com"> */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="535"></td><td class="FileContents-lineContents" id="535"><span class="kwd">static</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> max17055_load_batt_model_short_or_ez</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="536"></td><td class="FileContents-lineContents" id="536"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="537"></td><td class="FileContents-lineContents" id="537"><span class="pln">	</span><span class="typ">int</span><span class="pln"> hib_cfg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="538"></td><td class="FileContents-lineContents" id="538"><span class="pln">	</span><span class="typ">int</span><span class="pln"> dqacc</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="539"></td><td class="FileContents-lineContents" id="539"><span class="pln">	</span><span class="typ">int</span><span class="pln"> dpacc</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="540"></td><td class="FileContents-lineContents" id="540"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="541"></td><td class="FileContents-lineContents" id="541"><span class="pln">	</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">struct</span><span class="pln"> max17055_batt_profile </span><span class="pun">*</span><span class="pln">config</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="542"></td><td class="FileContents-lineContents" id="542"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="543"></td><td class="FileContents-lineContents" id="543"><span class="pln">	config </span><span class="pun">=</span><span class="pln"> max17055_get_batt_profile</span><span class="pun">();</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="544"></td><td class="FileContents-lineContents" id="544"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="545"></td><td class="FileContents-lineContents" id="545"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">is_ez_config</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="546"></td><td class="FileContents-lineContents" id="546"><span class="pln">		dqacc </span><span class="pun">=</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">design_cap </span><span class="pun">/</span><span class="pln"> </span><span class="lit">32</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="547"></td><td class="FileContents-lineContents" id="547"><span class="pln">		</span><span class="com">/* Choose the model for charge voltage &gt; 4.275V. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="548"></td><td class="FileContents-lineContents" id="548"><span class="pln">		dpacc </span><span class="pun">=</span><span class="pln"> dqacc </span><span class="pun">*</span><span class="pln"> </span><span class="lit">51200</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">design_cap</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="549"></td><td class="FileContents-lineContents" id="549"><span class="pln">	</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="550"></td><td class="FileContents-lineContents" id="550"><span class="pln">		dqacc </span><span class="pun">=</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">design_cap </span><span class="pun">/</span><span class="pln"> </span><span class="lit">16</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="551"></td><td class="FileContents-lineContents" id="551"><span class="pln">		dpacc </span><span class="pun">=</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">dpacc</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="552"></td><td class="FileContents-lineContents" id="552"><span class="pln">	</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="553"></td><td class="FileContents-lineContents" id="553"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="554"></td><td class="FileContents-lineContents" id="554"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_DESIGN_CAPACITY</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">design_cap</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="555"></td><td class="FileContents-lineContents" id="555"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_DQACC</span><span class="pun">,</span><span class="pln"> dqacc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="556"></td><td class="FileContents-lineContents" id="556"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_CHARGE_TERM_CURRENT</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">ichg_term</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="557"></td><td class="FileContents-lineContents" id="557"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_EMPTY_VOLTAGE</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">v_empty_detect</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="558"></td><td class="FileContents-lineContents" id="558"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="559"></td><td class="FileContents-lineContents" id="559"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="560"></td><td class="FileContents-lineContents" id="560"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">is_ez_config</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="561"></td><td class="FileContents-lineContents" id="561"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_LEARNCFG</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">learn_cfg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="562"></td><td class="FileContents-lineContents" id="562"><span class="pln">			</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="563"></td><td class="FileContents-lineContents" id="563"><span class="pln">	</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="564"></td><td class="FileContents-lineContents" id="564"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="565"></td><td class="FileContents-lineContents" id="565"><span class="pln">	</span><span class="com">/* Store the original HibCFG value. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="566"></td><td class="FileContents-lineContents" id="566"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_read</span><span class="pun">(</span><span class="pln">REG_HIBCFG</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">hib_cfg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="567"></td><td class="FileContents-lineContents" id="567"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="568"></td><td class="FileContents-lineContents" id="568"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="569"></td><td class="FileContents-lineContents" id="569"><span class="pln">	</span><span class="com">/* Force exit from hibernate */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="570"></td><td class="FileContents-lineContents" id="570"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_exit_hibernate</span><span class="pun">())</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="571"></td><td class="FileContents-lineContents" id="571"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="572"></td><td class="FileContents-lineContents" id="572"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="573"></td><td class="FileContents-lineContents" id="573"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_DPACC</span><span class="pun">,</span><span class="pln"> dpacc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="574"></td><td class="FileContents-lineContents" id="574"><span class="pln">	    max17055_write</span><span class="pun">(</span><span class="pln">REG_MODELCFG</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="pln">MODELCFG_REFRESH </span><span class="pun">|</span><span class="pln"> MODELCFG_VCHG</span><span class="pun">)))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="575"></td><td class="FileContents-lineContents" id="575"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="576"></td><td class="FileContents-lineContents" id="576"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="577"></td><td class="FileContents-lineContents" id="577"><span class="pln">	</span><span class="com">/* Delay up to 500 ms until MODELCFG.REFRESH bit == 0. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="578"></td><td class="FileContents-lineContents" id="578"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_poll_flag_clear</span><span class="pun">(</span><span class="pln">REG_MODELCFG</span><span class="pun">,</span><span class="pln"> MODELCFG_REFRESH</span><span class="pun">,</span><span class="pln"> </span><span class="lit">500</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="579"></td><td class="FileContents-lineContents" id="579"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="580"></td><td class="FileContents-lineContents" id="580"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="581"></td><td class="FileContents-lineContents" id="581"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">is_ez_config</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="582"></td><td class="FileContents-lineContents" id="582"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_RCOMP0</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">rcomp0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="583"></td><td class="FileContents-lineContents" id="583"><span class="pln">		    max17055_write</span><span class="pun">(</span><span class="pln">REG_TEMPCO</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">tempco</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="584"></td><td class="FileContents-lineContents" id="584"><span class="pln">		    max17055_write</span><span class="pun">(</span><span class="pln">REG_QR_TABLE00</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">qr_table00</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="585"></td><td class="FileContents-lineContents" id="585"><span class="pln">		    max17055_write</span><span class="pun">(</span><span class="pln">REG_QR_TABLE10</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">qr_table10</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="586"></td><td class="FileContents-lineContents" id="586"><span class="pln">		    max17055_write</span><span class="pun">(</span><span class="pln">REG_QR_TABLE20</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">qr_table20</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="587"></td><td class="FileContents-lineContents" id="587"><span class="pln">		    max17055_write</span><span class="pun">(</span><span class="pln">REG_QR_TABLE30</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">-&gt;</span><span class="pln">qr_table30</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="588"></td><td class="FileContents-lineContents" id="588"><span class="pln">			</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="589"></td><td class="FileContents-lineContents" id="589"><span class="pln">	</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="590"></td><td class="FileContents-lineContents" id="590"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="591"></td><td class="FileContents-lineContents" id="591"><span class="pln">	</span><span class="com">/* Restore the original HibCFG value. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="592"></td><td class="FileContents-lineContents" id="592"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_write</span><span class="pun">(</span><span class="pln">REG_HIBCFG</span><span class="pun">,</span><span class="pln"> hib_cfg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="593"></td><td class="FileContents-lineContents" id="593"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> EC_ERROR_UNKNOWN</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="594"></td><td class="FileContents-lineContents" id="594"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> EC_SUCCESS</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="595"></td><td class="FileContents-lineContents" id="595"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="596"></td><td class="FileContents-lineContents" id="596"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="597"></td><td class="FileContents-lineContents" id="597"><span class="kwd">static</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> max17055_load_batt_model</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="598"></td><td class="FileContents-lineContents" id="598"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="599"></td><td class="FileContents-lineContents" id="599"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">IS_ENABLED</span><span class="pun">(</span><span class="pln">CONFIG_BATTERY_MAX17055_FULL_MODEL</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="600"></td><td class="FileContents-lineContents" id="600"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> max17055_load_batt_model_full</span><span class="pun">();</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="601"></td><td class="FileContents-lineContents" id="601"><span class="pln">	</span><span class="kwd">else</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="602"></td><td class="FileContents-lineContents" id="602"><span class="pln">		</span><span class="kwd">return</span><span class="pln"> max17055_load_batt_model_short_or_ez</span><span class="pun">();</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="603"></td><td class="FileContents-lineContents" id="603"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="604"></td><td class="FileContents-lineContents" id="604"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="605"></td><td class="FileContents-lineContents" id="605"><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> max17055_init</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="606"></td><td class="FileContents-lineContents" id="606"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="607"></td><td class="FileContents-lineContents" id="607"><span class="pln">	</span><span class="typ">int</span><span class="pln"> reg</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="608"></td><td class="FileContents-lineContents" id="608"><span class="pln">	</span><span class="typ">int</span><span class="pln"> retries </span><span class="pun">=</span><span class="pln"> </span><span class="lit">80</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="609"></td><td class="FileContents-lineContents" id="609"><span class="com">#ifdef</span><span class="pln"> CONFIG_BATTERY_MAX17055_ALERT</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="610"></td><td class="FileContents-lineContents" id="610"><span class="pln">	</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">struct</span><span class="pln"> max17055_alert_profile </span><span class="pun">*</span><span class="pln">alert_profile </span><span class="pun">=</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="611"></td><td class="FileContents-lineContents" id="611"><span class="pln">		max17055_get_alert_profile</span><span class="pun">();</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="612"></td><td class="FileContents-lineContents" id="612"><span class="com">#endif</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="613"></td><td class="FileContents-lineContents" id="613"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="614"></td><td class="FileContents-lineContents" id="614"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">max17055_probe</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="615"></td><td class="FileContents-lineContents" id="615"><span class="pln">		CPRINTS</span><span class="pun">(</span><span class="str">&quot;Wrong max17055 id!&quot;</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="616"></td><td class="FileContents-lineContents" id="616"><span class="pln">		</span><span class="kwd">return</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="617"></td><td class="FileContents-lineContents" id="617"><span class="pln">	</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="618"></td><td class="FileContents-lineContents" id="618"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="619"></td><td class="FileContents-lineContents" id="619"><span class="pln">	</span><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="620"></td><td class="FileContents-lineContents" id="620"><span class="com">	 * Set CONFIG.TSEL to measure temperature using external thermistor.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="621"></td><td class="FileContents-lineContents" id="621"><span class="com">	 * Set it as early as possible because max17055 takes up to 1000ms to</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="622"></td><td class="FileContents-lineContents" id="622"><span class="com">	 * have the first reliable external temperature reading.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="623"></td><td class="FileContents-lineContents" id="623"><span class="com">	 */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="624"></td><td class="FileContents-lineContents" id="624"><span class="pln">	MAX17055_READ_DEBUG</span><span class="pun">(</span><span class="pln">REG_CONFIG</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="625"></td><td class="FileContents-lineContents" id="625"><span class="pln">	MAX17055_WRITE_DEBUG</span><span class="pun">(</span><span class="pln">REG_CONFIG</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="pln">reg </span><span class="pun">|</span><span class="pln"> CONF_TSEL</span><span class="pun">));</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="626"></td><td class="FileContents-lineContents" id="626"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="627"></td><td class="FileContents-lineContents" id="627"><span class="pln">	MAX17055_READ_DEBUG</span><span class="pun">(</span><span class="pln">REG_STATUS</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="628"></td><td class="FileContents-lineContents" id="628"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="629"></td><td class="FileContents-lineContents" id="629"><span class="pln">	</span><span class="com">/* Check for POR */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="630"></td><td class="FileContents-lineContents" id="630"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">STATUS_POR </span><span class="pun">&amp;</span><span class="pln"> reg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="631"></td><td class="FileContents-lineContents" id="631"><span class="pln">		</span><span class="com">/* Delay up to 800 ms until FSTAT.DNR bit == 0. */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="632"></td><td class="FileContents-lineContents" id="632"><span class="pln">		</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(--</span><span class="pln">retries</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="633"></td><td class="FileContents-lineContents" id="633"><span class="pln">			MAX17055_READ_DEBUG</span><span class="pun">(</span><span class="pln">REG_FSTAT</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="634"></td><td class="FileContents-lineContents" id="634"><span class="pln">			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!(</span><span class="pln">FSTAT_DNR </span><span class="pun">&amp;</span><span class="pln"> reg</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="635"></td><td class="FileContents-lineContents" id="635"><span class="pln">				</span><span class="kwd">break</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="636"></td><td class="FileContents-lineContents" id="636"><span class="pln">			msleep</span><span class="pun">(</span><span class="lit">10</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="637"></td><td class="FileContents-lineContents" id="637"><span class="pln">		</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="638"></td><td class="FileContents-lineContents" id="638"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">retries</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="639"></td><td class="FileContents-lineContents" id="639"><span class="pln">			CPRINTS</span><span class="pun">(</span><span class="str">&quot;%s: timeout waiting for FSTAT.DNR cleared&quot;</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="640"></td><td class="FileContents-lineContents" id="640"><span class="pln">				__func__</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="641"></td><td class="FileContents-lineContents" id="641"><span class="pln">			</span><span class="kwd">return</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="642"></td><td class="FileContents-lineContents" id="642"><span class="pln">		</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="643"></td><td class="FileContents-lineContents" id="643"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="644"></td><td class="FileContents-lineContents" id="644"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_load_batt_model</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="645"></td><td class="FileContents-lineContents" id="645"><span class="pln">			CPRINTS</span><span class="pun">(</span><span class="str">&quot;max17055 configuration failed!&quot;</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="646"></td><td class="FileContents-lineContents" id="646"><span class="pln">			</span><span class="kwd">return</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="647"></td><td class="FileContents-lineContents" id="647"><span class="pln">		</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="648"></td><td class="FileContents-lineContents" id="648"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="649"></td><td class="FileContents-lineContents" id="649"><span class="pln">		</span><span class="com">/* Clear POR bit */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="650"></td><td class="FileContents-lineContents" id="650"><span class="pln">		MAX17055_READ_DEBUG</span><span class="pun">(</span><span class="pln">REG_STATUS</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="651"></td><td class="FileContents-lineContents" id="651"><span class="pln">		MAX17055_WRITE_DEBUG</span><span class="pun">(</span><span class="pln">REG_STATUS</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="pln">reg </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">~</span><span class="pln">STATUS_POR</span><span class="pun">));</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="652"></td><td class="FileContents-lineContents" id="652"><span class="pln">	</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="653"></td><td class="FileContents-lineContents" id="653"><span class="pln">		</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">struct</span><span class="pln"> max17055_batt_profile </span><span class="pun">*</span><span class="pln">config</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="654"></td><td class="FileContents-lineContents" id="654"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="655"></td><td class="FileContents-lineContents" id="655"><span class="pln">		config </span><span class="pun">=</span><span class="pln"> max17055_get_batt_profile</span><span class="pun">();</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="656"></td><td class="FileContents-lineContents" id="656"><span class="pln">		MAX17055_READ_DEBUG</span><span class="pun">(</span><span class="pln">REG_DESIGN_CAPACITY</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="657"></td><td class="FileContents-lineContents" id="657"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="658"></td><td class="FileContents-lineContents" id="658"><span class="pln">		</span><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="659"></td><td class="FileContents-lineContents" id="659"><span class="com">		 * Reload the battery model if the current running one</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="660"></td><td class="FileContents-lineContents" id="660"><span class="com">		 * is wrong.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="661"></td><td class="FileContents-lineContents" id="661"><span class="com">		 */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="662"></td><td class="FileContents-lineContents" id="662"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">design_cap </span><span class="pun">!=</span><span class="pln"> reg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="663"></td><td class="FileContents-lineContents" id="663"><span class="pln">			CPRINTS</span><span class="pun">(</span><span class="str">&quot;max17055 reconfig...&quot;</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="664"></td><td class="FileContents-lineContents" id="664"><span class="pln">			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">max17055_load_batt_model</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="665"></td><td class="FileContents-lineContents" id="665"><span class="pln">				CPRINTS</span><span class="pun">(</span><span class="str">&quot;max17055 configuration failed!&quot;</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="666"></td><td class="FileContents-lineContents" id="666"><span class="pln">				</span><span class="kwd">return</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="667"></td><td class="FileContents-lineContents" id="667"><span class="pln">			</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="668"></td><td class="FileContents-lineContents" id="668"><span class="pln">		</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="669"></td><td class="FileContents-lineContents" id="669"><span class="pln">	</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="670"></td><td class="FileContents-lineContents" id="670"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="671"></td><td class="FileContents-lineContents" id="671"><span class="com">#ifdef</span><span class="pln"> CONFIG_BATTERY_MAX17055_ALERT</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="672"></td><td class="FileContents-lineContents" id="672"><span class="pln">	</span><span class="com">/* Set voltage alert range */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="673"></td><td class="FileContents-lineContents" id="673"><span class="pln">	MAX17055_WRITE_DEBUG</span><span class="pun">(</span><span class="pln">REG_VALRTTH</span><span class="pun">,</span><span class="pln"> alert_profile</span><span class="pun">-&gt;</span><span class="pln">v_alert_mxmn</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="674"></td><td class="FileContents-lineContents" id="674"><span class="pln">	</span><span class="com">/* Set temperature alert range */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="675"></td><td class="FileContents-lineContents" id="675"><span class="pln">	MAX17055_WRITE_DEBUG</span><span class="pun">(</span><span class="pln">REG_TALRTTH</span><span class="pun">,</span><span class="pln"> alert_profile</span><span class="pun">-&gt;</span><span class="pln">t_alert_mxmn</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="676"></td><td class="FileContents-lineContents" id="676"><span class="pln">	</span><span class="com">/* Set state-of-charge alert range */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="677"></td><td class="FileContents-lineContents" id="677"><span class="pln">	MAX17055_WRITE_DEBUG</span><span class="pun">(</span><span class="pln">REG_SALRTTH</span><span class="pun">,</span><span class="pln"> alert_profile</span><span class="pun">-&gt;</span><span class="pln">s_alert_mxmn</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="678"></td><td class="FileContents-lineContents" id="678"><span class="pln">	</span><span class="com">/* Set current alert range */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="679"></td><td class="FileContents-lineContents" id="679"><span class="pln">	MAX17055_WRITE_DEBUG</span><span class="pun">(</span><span class="pln">REG_IALRTTH</span><span class="pun">,</span><span class="pln"> alert_profile</span><span class="pun">-&gt;</span><span class="pln">i_alert_mxmn</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="680"></td><td class="FileContents-lineContents" id="680"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="681"></td><td class="FileContents-lineContents" id="681"><span class="pln">	</span><span class="com">/* Disable all sticky bits; enable alert AEN */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="682"></td><td class="FileContents-lineContents" id="682"><span class="pln">	MAX17055_READ_DEBUG</span><span class="pun">(</span><span class="pln">REG_CONFIG</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="683"></td><td class="FileContents-lineContents" id="683"><span class="pln">	MAX17055_WRITE_DEBUG</span><span class="pun">(</span><span class="pln">REG_CONFIG</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="pln">reg </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">~</span><span class="pln">CONF_ALL_STICKY</span><span class="pun">)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> CONF_AEN</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="684"></td><td class="FileContents-lineContents" id="684"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="685"></td><td class="FileContents-lineContents" id="685"><span class="pln">	</span><span class="com">/* Clear alerts */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="686"></td><td class="FileContents-lineContents" id="686"><span class="pln">	MAX17055_READ_DEBUG</span><span class="pun">(</span><span class="pln">REG_STATUS</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">reg</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="687"></td><td class="FileContents-lineContents" id="687"><span class="pln">	MAX17055_WRITE_DEBUG</span><span class="pun">(</span><span class="pln">REG_STATUS</span><span class="pun">,</span><span class="pln"> reg </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">~</span><span class="pln">STATUS_ALL_ALRT</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="688"></td><td class="FileContents-lineContents" id="688"><span class="com">#endif</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="689"></td><td class="FileContents-lineContents" id="689"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="690"></td><td class="FileContents-lineContents" id="690"><span class="pln">	CPRINTS</span><span class="pun">(</span><span class="str">&quot;max17055 configuration succeeded!&quot;</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="691"></td><td class="FileContents-lineContents" id="691"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="692"></td><td class="FileContents-lineContents" id="692"><span class="pln">DECLARE_HOOK</span><span class="pun">(</span><span class="pln">HOOK_INIT</span><span class="pun">,</span><span class="pln"> max17055_init</span><span class="pun">,</span><span class="pln"> HOOK_PRIO_DEFAULT</span><span class="pun">);</span></td></tr></table><script nonce="swrwri0sowfzHaDliVzQCA">for (let lineNumEl of document.querySelectorAll('td.u-lineNum')) {lineNumEl.onclick = () => {window.location.hash = `#${lineNumEl.getAttribute('data-line-number')}`;};}</script></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a>| <a href="https://policies.google.com/terms">Terms</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>